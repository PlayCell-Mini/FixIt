<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fixit üîß | Find Local Helpers Near You</title>
  <link rel="stylesheet" href="style.css" />
  <!-- Google Fonts for better typography -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- AWS SDK will be added here if needed -->
</head>

<body>
  <div class="homepage-container">
    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
      <div class="mobile-nav-header">
        <h1 class="mobile-logo">Fixit üîß</h1>
        <button class="hamburger-btn" id="hamburgerBtn" aria-label="Toggle menu">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
      <div class="mobile-nav-menu" id="mobileNavMenu">
        <a href="signup.html" class="mobile-nav-link">Sign Up</a>
        <a href="login.html" class="mobile-nav-link">Login</a>
      </div>
    </nav>

    <!-- Desktop Header -->
    <header class="desktop-header">
      <div class="header-content">
        <h1>Fixit üîß</h1>
        <p>Find trusted local service providers easily.</p>
      </div>
    </header>

    <main class="main-content">
      <div class="hero-section">
        <h2>Welcome to Fixit</h2>
        <p>Your city's best plumbers, electricians, tutors & more ‚Äî all in one place.</p>
      </div>

      <!-- Signup Form (Hidden by default) -->
      <div id="signup-form-container" style="display: none; max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="text-align: center; margin-bottom: 20px;">Create Your Account</h2>
        <form id="direct-signup-form">
          <div style="margin-bottom: 15px;">
            <label for="direct-fullname" style="display: block; margin-bottom: 5px;">Full Name</label>
            <input type="text" id="direct-fullname" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label for="direct-email" style="display: block; margin-bottom: 5px;">Email</label>
            <input type="email" id="direct-email" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label for="direct-password" style="display: block; margin-bottom: 5px;">Password</label>
            <input type="password" id="direct-password" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label for="direct-address" style="display: block; margin-bottom: 5px;">Address</label>
            <input type="text" id="direct-address" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required>
          </div>
          
          <div style="margin-bottom: 15px;">
            <label for="direct-role" style="display: block; margin-bottom: 5px;">Role</label>
            <select id="direct-role" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;" required>
              <option value="">Select your role</option>
              <option value="owner">Service Owner</option>
              <option value="provider">Service Provider</option>
            </select>
          </div>
          
          <!-- Service Type Selection - Hidden by default -->
          <div id="direct-service-type-section" style="display: none; margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 5px;">Service Type</label>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
              <button type="button" class="direct-service-option" data-value="Plumber" style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #f5f5f5; cursor: pointer;">Plumber</button>
              <button type="button" class="direct-service-option" data-value="Electrician" style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #f5f5f5; cursor: pointer;">Electrician</button>
              <button type="button" class="direct-service-option" data-value="Painter" style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #f5f5f5; cursor: pointer;">Painter</button>
              <button type="button" class="direct-service-option" data-value="AC Technician" style="padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; background: #f5f5f5; cursor: pointer;">AC Technician</button>
            </div>
            <!-- Hidden input to store the selected service type -->
            <input type="hidden" id="selectedServiceTypeInput" value="">
          </div>
          
          <div style="text-align: center; margin-top: 20px;">
            <button type="submit" id="direct-signup-btn" style="padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Sign Up</button>
            <button type="button" id="cancel-direct-signup" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancel</button>
          </div>
        </form>
      </div>

      <div class="action-buttons">
        <button class="action-btn primary-btn" id="signup-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="8.5" cy="7" r="4"></circle>
            <path d="M20 8v6"></path>
            <path d="M23 11h-6"></path>
          </svg>
          Sign Up
        </button>
        <a href="login.html" class="btn-link">
          <button class="action-btn secondary-btn" id="login-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10,17 15,12 10,7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            Login
          </button>
        </a>
      </div>

      <!-- Auth Container for Dynamic UI (used by app.js) -->
      <section id="auth-container">
        <div id="output" class="output-section"></div>
      </section>
    </main>

    <footer class="footer">
      <p>¬© 2025 Fixit | Built with ‚ù§Ô∏è for local communities</p>
    </footer>
  </div>

  <!-- <script src="awsConfig.js"></script> -->
  <script src="app.js"></script>
  <script>
    // Mobile navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
      const hamburgerBtn = document.getElementById('hamburgerBtn');
      const mobileNavMenu = document.getElementById('mobileNavMenu');
      const mobileNav = document.getElementById('mobileNav');

      hamburgerBtn.addEventListener('click', function() {
        mobileNavMenu.classList.toggle('active');
        hamburgerBtn.classList.toggle('active');
        mobileNav.classList.toggle('menu-open');
      });

      // Close menu when clicking on links
      const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
      mobileNavLinks.forEach(link => {
        link.addEventListener('click', function() {
          mobileNavMenu.classList.remove('active');
          hamburgerBtn.classList.remove('active');
          mobileNav.classList.remove('menu-open');
        });
      });

      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        if (!mobileNav.contains(event.target)) {
          mobileNavMenu.classList.remove('active');
          hamburgerBtn.classList.remove('active');
          mobileNav.classList.remove('menu-open');
        }
      });
      
      // Direct signup form functionality
      const signupBtn = document.getElementById('signup-btn');
      const signupFormContainer = document.getElementById('signup-form-container');
      const directSignupForm = document.getElementById('direct-signup-form');
      const directRoleSelect = document.getElementById('direct-role');
      const directServiceTypeSection = document.getElementById('direct-service-type-section');
      const directServiceOptions = document.querySelectorAll('.direct-service-option');
      const selectedServiceTypeInput = document.getElementById('selectedServiceTypeInput');
      const cancelDirectSignup = document.getElementById('cancel-direct-signup');
      
      // Toggle signup form visibility
      signupBtn.addEventListener('click', function(e) {
        e.preventDefault();
        signupFormContainer.style.display = 'block';
      });
      
      // Cancel direct signup
      cancelDirectSignup.addEventListener('click', function() {
        signupFormContainer.style.display = 'none';
      });
      
      // Toggle service type section based on role
      directRoleSelect.addEventListener('change', function() {
        if (this.value === 'provider') {
          directServiceTypeSection.style.display = 'block';
        } else {
          directServiceTypeSection.style.display = 'none';
          selectedServiceTypeInput.value = '';
        }
      });
      
      // Handle service type selection
      directServiceOptions.forEach(option => {
        option.addEventListener('click', function() {
          // Remove selected class from all options
          directServiceOptions.forEach(opt => opt.style.background = '#f5f5f5');
          
          // Add selected style to clicked option
          this.style.background = '#007bff';
          this.style.color = 'white';
          
          // Update the hidden input field
          selectedServiceTypeInput.value = this.getAttribute('data-value');
        });
      });
      
      // Direct signup form submission
      directSignupForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Get form values
        const fullName = document.getElementById('direct-fullname').value.trim();
        const email = document.getElementById('direct-email').value.trim();
        const password = document.getElementById('direct-password').value;
        const address = document.getElementById('direct-address').value.trim();
        const role = document.getElementById('direct-role').value;
        
        // CRITICAL: Retrieve the serviceType value directly from the hidden input
        const serviceType = document.getElementById('selectedServiceTypeInput').value;
        
        // Basic validation
        if (!fullName || !email || !password || !address || !role) {
          alert('Please fill in all fields');
          return;
        }
        
        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address');
          return;
        }
        
        // Password validation (simple check)
        if (password.length < 8) {
          alert('Password must be at least 8 characters long');
          return;
        }
        
        // CRITICAL VALIDATION: Service type validation for providers
        if (role === 'provider') {
          // Strictly validate that the serviceType value is not empty
          if (!serviceType || serviceType === "" || serviceType === null) {
            alert('Please select a service type');
            return;
          }
        }
        
        // Show loading state
        const submitBtn = document.getElementById('direct-signup-btn');
        const originalBtnText = submitBtn.textContent;
        submitBtn.textContent = 'Signing up...';
        submitBtn.disabled = true;
        
        try {
          // CRITICAL: Payload Match - Prepare signup data with correct structure
          const signupData = {
            fullName: fullName,
            email: email,
            password: password,
            role: role,
            address: address,
            serviceType: role === 'provider' ? serviceType : null
          };
          
          console.log('üì§ Sending signup data:', signupData);
          
          // CRITICAL: Frontend Validation Check - Send request to backend API
          const response = await fetch('/api/auth/signup', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(signupData)
          });
          
          const data = await response.json();
          
          if (response.ok && data.success) {
            alert('Account created successfully! Please check your email to verify your account.');
            // Reset form
            directSignupForm.reset();
            // Hide form
            document.getElementById('signup-form-container').style.display = 'none';
            // Reset service type input
            document.getElementById('selectedServiceTypeInput').value = '';
          } else {
            alert('Signup failed: ' + (data.message || 'Unknown error'));
          }
        } catch (error) {
          console.error('Signup error:', error);
          alert('An error occurred during signup. Please try again.');
        } finally {
          // Reset button state
          submitBtn.textContent = originalBtnText;
          submitBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>